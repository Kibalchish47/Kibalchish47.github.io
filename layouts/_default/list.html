{{/* layouts/_default/list.html */}}
{{ define "main" }}
<div class="container mx-auto px-6 py-10">
    <h1 class="text-4xl font-bold text-center mb-4 text-custom-gray-800 dark:text-custom-red-100">{{ .Title }}</h1>

    {{ if .Content }}
        <div class="prose dark:prose-invert mx-auto text-center mb-12">{{ .Content }}</div>
    {{ end }}

    {{/* --- Tag Filter Buttons --- */}}
    {{/* We find all tags used ONLY in the pages of this section */}}
    {{ $tags := slice }}
    {{ range .Pages }}
        {{ $tags = $tags | append .Params.tags }}
    {{ end }}
    {{ $tags = $tags | uniq | sort }}

    {{ if gt (len $tags) 0 }}
    <div id="tag-filter" class="flex flex-wrap justify-center gap-2 mb-10">
        <button class="tag-filter-btn active" data-tag="all">All</button>
        {{ range $tags }}
            <button class="tag-filter-btn" data-tag="{{ . | urlize }}">{{ . }}</button>
        {{ end }}
    </div>
    {{ end }}
    {{/* --- End Tag Filter --- */}}

    {{/* Grid for Cards - handles different layouts */}}
    {{ $gridClass := "grid md:grid-cols-2 lg:grid-cols-3 gap-8" }}
    {{ if or (eq .Type "blog") (eq .Type "publications") }}
        {{ $gridClass = "space-y-8 max-w-3xl mx-auto" }}
    {{ end }}

    <div class="{{ $gridClass }}">
        {{ range .Paginator.Pages }}
            <div class="filterable-card" data-tags="{{ range .Params.tags }}{{ . | urlize }} {{ end }}">
                {{ partial "unified-card.html" . }}
            </div>
        {{ else }}
            <p class="text-center text-custom-gray-600 col-span-full">There's nothing here yet. Please check back soon!</p>
        {{ end }}
    </div>

    {{ partial "pagination.html" . }}
</div>
{{ end }}
